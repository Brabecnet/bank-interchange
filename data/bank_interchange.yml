database:
  name: bank_interchange
  project: aryelgois/bank-interchange
  license: MIT

definitions:
  pk: int PRIMARY KEY
  pk_auto: pk AUTO_INCREMENT
  name: varchar(60)
  money: decimal(17,4)
  money_small: decimal(6,4)

tables:

  # Helper Tables

  full_addresses:
    id: pk_auto
    county: int # -> address counties.id
    neighborhood: name
    place: name
    number: varchar(20)
    zipcode: varchar(8)
    detail: name DEFAULT ''
    update: timestamp

  people:
    id: pk_auto
    name: name
    document: varchar(14)

  currencies:
    id: tinyint PRIMARY KEY AUTO_INCREMENT
    symbol: varchar(5)
    name: varchar(30)
    name_plural: varchar(30) NULLABLE
    decimals: tinyint DEFAULT 2
    thousand: char(1)
    decimal: char(1)

  currency_codes:
    currency: tinyint -> currencies.id
    bank: int -> banks.id UNIQUE
    billet: char(1)
    cnab240: char(2)
    cnab400: char(1)

  wallets:
    id: tinyint PRIMARY KEY AUTO_INCREMENT
    bank: int -> banks.id
    cnab: char(3)
    code: varchar(2)      # used in cnab
    operation: varchar(2) # used in billets barcode
    symbol: char(2)
    name: name

  # Main Tables

  assignors:
    id: pk_auto
    person: int -> people.id UNIQUE
    address: int -> full_addresses.id
    logo: varchar(30) NULLABLE
    url: varchar(30) NULLABLE

  assignments:
    id: pk_auto
    assignor: int -> assignors.id
    bank: int -> banks.id
    wallet: tinyint -> wallets.id
    covenant: char(20)
    agency: char(5)
    agency_cd: char(1)
    account: char(11)
    account_cd: char(1)
    edi: char(6)

  banks:
    id: pk_auto
    code: char(3)
    name: name
    view: varchar(30)
    logo: varchar(30) NULLABLE
    tax: money_small

  clients:
    id: pk_auto
    person: int -> people.id
    address: int -> full_addresses.id
    assignor: int -> assignors.id

  titles:
    id: pk_auto
    assignment: int -> assignments.id
    client: int -> clients.id
    guarantor: int -> clients.id NULLABLE
    currency: tinyint -> currencies.id
    our_number: int
    status: tinyint(1) NULLABLE
    doc_type: char(1) DEFAULT 1
    kind: tinyint(2)
    value: money
    value_paid: money DEFAULT 0
    iof: money
    rebate: money
    tax: money_small
    fine_type: tinyint(1) DEFAULT 3
    fine_date: date NULLABLE
    fine_value: money NULLABLE
    discount_type: enum('1','2') DEFAULT '1'
    discount_date: date NULLABLE
    discount_value: money NULLABLE
    description: varchar(25)
    due: date
    stamp: timestamp DEFAULT CURRENT_TIMESTAMP
    update: datetime NULLABLE

  shipping_files:
    id: pk_auto
    assignment: int -> assignments.id
    counter: int
    status: tinyint(1) NULLABLE
    stamp: timestamp DEFAULT CURRENT_TIMESTAMP
    update: datetime NULLABLE

  shipping_file_titles:
    shipping_file: int -> shipping_files.id
    title: int -> titles.id

composite:
  - UNIQUE currency_codes currency bank
  - UNIQUE clients person assignor
  - UNIQUE titles assignment our_number
  - UNIQUE shipping_files assignment counter
  - PRIMARY shipping_file_titles shipping_file title
